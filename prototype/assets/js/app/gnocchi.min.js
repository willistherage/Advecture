/**
 * Build Date: 2014-10-04 20:05:55
 * 
 */
"use strict";var GNOCCHI={version:"0.1",mobile:!1,GL:null};(function(){GNOCCHI.mobile=function(){var t=navigator.userAgent.match(/Android/i),e=navigator.userAgent.match(/iPhone/i),i=navigator.userAgent.match(/iPad/i);return t||e||i?(console.log("HDBG: Running on mobile device."),!0):!1}(),Math.fround||(Math.fround=function(){var t=new Float32Array(1);return function(e){return t[0]=+e,t[0]}}()),Math.clamp||(Math.clamp=function(t,e,i){var n=Math.max(e,Math.min(t,i));return n}),Math.clamp01||(Math.clamp01=function(t){var e=0,i=1,n=Math.max(e,Math.min(t,i));return n}),GNOCCHI.parseFloat4=function(t){var e=new Float32Array([0,0,0,0]),i=t;return t instanceof Array&&1==t.length&&(i=t[0]),i instanceof GNOCCHI.Vec2?e.set([i.x,i.y]):i instanceof GNOCCHI.Vec3?e.set([i.x,i.y,i.z]):i instanceof GNOCCHI.Vec4?e.set([i.x,i.y,i.z,i.w]):i instanceof GNOCCHI.Color?e.set([i.r,i.g,i.b]):i instanceof GNOCCHI.ColorA?e.set([i.r,i.g,i.b,i.a]):i instanceof Array?e.set([i[0]||0,i[1]||0,i[2]||0,i[3]||0]):e.set([i]),e}})(),GNOCCHI=function(t){var e=function(t,e,i){this.m=new Float32Array([t||0,e||0,i||0])};return e.prototype={constructor:e,get r(){return this.m[0]},set r(t){this.m[0]=t},get g(){return this.m[1]},set g(t){this.m[1]=t},get b(){return this.m[2]},set b(t){this.m[2]=t},copy:function(t){return this.m[0]=t.m[0],this.m[1]=t.m[1],this.m[2]=t.m[2],this},set:function(t,e,i){return this.m[0]=t,this.m[1]=e,this.m[2]=i,this},setV:function(){var t=GNOCCHI.parseFloat4([].slice.call(arguments));return this.m[0]=t[0],this.m[1]=t[1],this.m[2]=t[2],this}},e.create=function(t,i,n){var r=new e(t,i,n);return r},e.createV=function(){var t=GNOCCHI.parseFloat4([].slice.call(arguments)),i=new e(t[0],t[1],t[2]);return i},t.Color=e,t}(GNOCCHI),GNOCCHI=function(t){var e=function(t,e,i,n){this.m=new Float32Array([t||0,e||0,i||0,n||0])};return e.prototype={constructor:e,get r(){return this.m[0]},set r(t){this.m[0]=t},get g(){return this.m[1]},set g(t){this.m[1]=t},get b(){return this.m[2]},set b(t){this.m[2]=t},get a(){return this.m[3]},set a(t){this.m[3]=t},copy:function(t){return this.m[0]=t.m[0],this.m[1]=t.m[1],this.m[2]=t.m[2],this.m[3]=t.m[3],this},set:function(t,e,i,n){return this.m[0]=t,this.m[1]=e,this.m[2]=i,this.m[3]=n,this},setV:function(){var t=GNOCCHI.parseFloat4([].slice.call(arguments));return this.m[0]=t[0],this.m[1]=t[1],this.m[2]=t[2],this.m[3]=arguments[0]instanceof GNOCCHI.Color?1:t[3],this}},e.create=function(t,i,n,r){var s=new e(t,i,n,r);return s},e.createV=function(){var t=GNOCCHI.parseFloat4([].slice.call(arguments)),i=new e(t[0],t[1],t[2],t[3]);return i},t.ColorA=e,t}(GNOCCHI),GNOCCHI=function(t){var e=function(t,e,i,n){this.x1=Math.fround(t),this.y1=Math.fround(e),this.x2=Math.fround(i),this.y2=Math.fround(n)};return e.prototype={constructor:e,clone:function(){var t=new e(this.x1,this.y1,this.x2,this.y2);return t},getWidth:function(){var t=this.x2-this.x1;return t},getHeight:function(){var t=this.y2-this.y1;return t},set:function(t,e,i,n){this.x1=Math.fround(t),this.y1=Math.fround(e),this.x2=Math.fround(i),this.y2=Math.fround(n)},scale:function(){var t=1,e=1;1==arguments.length?arguments[0]instanceof GNOCCHI.Vec2?(t=arguments[0].x,e=arguments[0].y):(t=arguments[0],e=arguments[0]):2==arguments.length&&(t=arguments[0],e=arguments[1]);var i=this.getWidth(),n=this.getHeight();return this.x2=this.x1+t*i,this.y2=this.y1+e*n,this},scaledCenter:function(){var t=1,e=1;1==arguments.length?arguments[0]instanceof GNOCCHI.Vec2?(t=arguments[0].x,e=arguments[0].y):(t=arguments[0],e=arguments[0]):2==arguments.length&&(t=arguments[0],e=arguments[1]);var i=(this.x1+this.x2)/2,n=(this.y1+this.y2)/2,r=t*this.getWidth()/2,s=e*this.getHeight()/2;return this.x1=i-r,this.y1=n-s,this.x2=i+r,this.y2=n+s,this},scaled:function(){var t=this.clone();return e.prototype.scale.apply(t,arguments),t},moved:function(){var t=0,i=0;1==arguments.length?(t=arguments[0].x,i=arguments[0].y):2==arguments.length&&(t=arguments[0],i=arguments[1]);var n=new e(this.x1+t,this.y1+i,this.x2+t,this.y2+i);return n}},t.Rect=e,t}(GNOCCHI),GNOCCHI=function(t){var e=function(t,e){this.m=new Float32Array([t||0,e||0])};return e.prototype={constructor:e,get x(){return this.m[0]},set x(t){this.m[0]=t},get y(){return this.m[1]},set y(t){this.m[1]=t},copy:function(t){return this.m[0]=t.m[0],this.m[1]=t.m[1],this},set:function(t,e){return this.m[0]=t,this.m[1]=e,this},setV:function(){var t=GNOCCHI.parseFloat4([].slice.call(arguments));return this.m[0]=t[0],this.m[1]=t[1],this.m[2]=t[2],this},negate:function(){return this.m[0]=-this.m[0],this.m[1]=-this.m[1],this},negative:function(){var t=new e(-this.m[0],-this.m[1]);return t},multiplyScalar:function(t){return this.m[0]*=t,this.m[1]*=t,this},add:function(t){return this.m[0]+=t.m[0],this.m[1]+=t.m[1],this},addVectors:function(t,e){return this.m[0]=t.m[0]+e.m[0],this.m[1]=t.m[1]+e.m[1],this},sub:function(t){return this.m[0]-=t.m[0],this.m[1]-=t.m[1],this},subVectors:function(t,e){return this.m[0]=t.m[0]-e.m[0],this.m[1]=t.m[1]-e.m[1],this},length:function(){var t=this.m[0],e=this.m[1],i=Math.sqrt(t*t+e*e);return i},lengthSquared:function(){var t=this.m[0],e=this.m[1],i=t*t+e*e;return i},normalize:function(){var t=this.m[0],e=this.m[1],i=Math.fround(1/Math.sqrt(t*t+e*e));return this.m[0]*=i,this.m[1]*=i,this},normalized:function(){var t=this.m[0],i=this.m[1],n=Math.fround(1/Math.sqrt(t*t+i*i));return new e(t*n,i*n)},distance:function(t){var e=t.m[0]-this.m[0],i=t.m[1]-this.m[1],n=Math.sqrt(e*e+i*i);return n},distanceSquared:function(t){var e=t.m[0]-this.m[0],i=t.m[1]-this.m[1],n=e*e+i*i;return n},dot:function(t){var e=this.m[0],i=this.m[1],n=t.m[0],r=t.m[1],s=e*n+i*r;return s},toRadians:function(){var t=Math.PI/180,i=new e(this.m[0]*t,this.m[1]*t);return i},toDegrees:function(){var t=180/Math.PI,i=new e(this.m[0]*t,this.m[1]*t);return i}},e.create=function(t,i){var n=new e(t,i);return n},e.createV=function(){var t=GNOCCHI.parseFloat4([].slice.call(arguments)),i=new e(t[0],t[1]);return i},t.Vec2=e,t}(GNOCCHI),GNOCCHI=function(t){var e=function(t,e,i){this.m=new Float32Array([t||0,e||0,i||0])};return e.prototype={constructor:e,get x(){return this.m[0]},set x(t){this.m[0]=t},get y(){return this.m[1]},set y(t){this.m[1]=t},get z(){return this.m[2]},set z(t){this.m[2]=t},copy:function(t){return this.m[0]=t.m[0],this.m[1]=t.m[1],this.m[2]=t.m[2],this},set:function(t,e,i){return this.m[0]=t,this.m[1]=e,this.m[2]=i,this},setV:function(){var t=GNOCCHI.parseFloat4([].slice.call(arguments));return this.m[0]=t[0],this.m[1]=t[1],this.m[2]=t[2],this},negate:function(){return this.m[0]=-this.m[0],this.m[1]=-this.m[1],this.m[2]=-this.m[2],this},negative:function(){var t=new e(-this.m[0],-this.m[1],-this.m[2]);return t},add:function(t){return this.m[0]+=t.m[0],this.m[1]+=t.m[1],this.m[2]+=t.m[2],this},addVectors:function(t,e){return this.m[0]=t.m[0]+e.m[0],this.m[1]=t.m[1]+e.m[1],this.m[2]=t.m[2]+e.m[2],this},sub:function(t){return this.m[0]-=t.m[0],this.m[1]-=t.m[1],this.m[2]-=t.m[2],this},subVectors:function(t,e){return this.m[0]=t.m[0]-e.m[0],this.m[1]=t.m[1]-e.m[1],this.m[2]=t.m[2]-e.m[2],this},multiplyScalar:function(t){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=t,this},multiply:function(t){return this.m[0]*=t.m[0],this.m[1]*=t.m[1],this.m[2]*=t.m[2],this},multiplyVectors:function(t,e){return this.m[0]=t.m[0]*e.m[0],this.m[1]=t.m[1]*e.m[1],this.m[2]=t.m[2]*e.m[2],this},length:function(){var t=this.m[0],e=this.m[1],i=this.m[2],n=Math.sqrt(t*t+e*e+i*i);return n},lengthSquared:function(){var t=this.m[0],e=this.m[1],i=this.m[2],n=t*t+e*e+i*i;return n},normalize:function(){var t=this.m[0],e=this.m[1],i=this.m[2],n=1/Math.sqrt(t*t+e*e+i*i);return this.m[0]*=n,this.m[1]*=n,this.m[2]*=n,this},normalized:function(){var t=this.m[0],i=this.m[1],n=this.m[2],r=1/Math.sqrt(t*t+i*i+n*n);return new e(t*r,i*r,n*r)},distance:function(t){var e=t.m[0]-this.m[0],i=t.m[1]-this.m[1],n=t.m[2]-this.m[2],r=Math.sqrt(e*e+i*i+n*n);return r},distanceSquared:function(t){var e=t.m[0]-this.m[0],i=t.m[1]-this.m[1],n=t.m[2]-this.m[2],r=e*e+i*i+n*n;return r},dot:function(t){var e=this.m[0],i=this.m[1],n=this.m[2],r=t.m[0],s=t.m[1],a=t.m[2],o=e*r+i*s+n*a;return o},cross:function(t,e){var i=t.m[0],n=t.m[1],r=t.m[2],s=e.m[0],a=e.m[1],o=e.m[2];return this.x=n*o-r*a,this.y=r*s-i*o,this.z=i*a-n*s,this},toRadians:function(){var t=Math.PI/180,i=new e(this.m[0]*t,this.m[1]*t,this.m[2]*t);return i},toDegrees:function(){var t=180/Math.PI,i=new e(this.m[0]*t,this.m[1]*t,this.m[2]*t);return i}},e.create=function(t,i,n){var r=new e(t,i,n);return r},e.createV=function(){var t=GNOCCHI.parseFloat4([].slice.call(arguments)),i=new e(t[0],t[1],t[2]);return i},e.addVectors=function(t,i){var n=t.m[0]+i.m[0],r=t.m[1]+i.m[1],s=t.m[2]+i.m[2],a=new e(n,r,s);return a},e.addStore=function(t,e,i){i.m[0]=t.m[0]+e.m[0],i.m[1]=t.m[1]+e.m[1],i.m[2]=t.m[2]+e.m[2]},e.subVectors=function(t,i){var n=t.m[0]-i.m[0],r=t.m[1]-i.m[1],s=t.m[2]-i.m[2],a=new e(n,r,s);return a},e.subStore=function(t,e,i){i.m[0]=e.m[0]-t.m[0],i.m[1]=e.m[1]-t.m[1],i.m[2]=e.m[2]-t.m[2]},e.multiplyScalar=function(t,i){var n=t.m[0],r=t.m[1],s=t.m[2],a=new e(n*i,r*i,s*i);return a},e.multiplyVectors=function(t,i){var n=t.m[0]-i.m[0],r=t.m[1]-i.m[1],s=t.m[2]-i.m[2],a=new e(n,r,s);return a},e.multiplyStore=function(t,e,i){i.m[0]=e.m[0]*t.m[0],i.m[1]=e.m[1]*t.m[1],i.m[2]=e.m[2]*t.m[2]},e.mix=function(t,i,n){var r=i.m[0]-t.m[0],s=i.m[1]-t.m[1],a=i.m[2]-t.m[2],o=this.a[0]+n*r,h=this.a[1]+n*s,u=this.a[2]+n*a,c=new e(o,h,u);return c},t.Vec3=e,t}(GNOCCHI),GNOCCHI=function(t){var e=function(t,e,i,n){this.m=new Float32Array([t||0,e||0,i||0,n||0])};return e.prototype={constructor:e,get x(){return this.m[0]},set x(t){this.m[0]=t},get y(){return this.m[1]},set y(t){this.m[1]=t},get z(){return this.m[2]},set z(t){this.m[2]=t},get w(){return this.m[3]},set w(t){this.m[3]=t},copy:function(t){return this.m[0]=t.m[0],this.m[1]=t.m[1],this.m[2]=t.m[2],this.m[3]=t.m[3],this},set:function(t,e,i,n){return this.m[0]=t,this.m[1]=e,this.m[2]=i,this.m[3]=n,this},setV:function(){var t=GNOCCHI.parseFloat4([].slice.call(arguments));return this.m[0]=t[0],this.m[1]=t[1],this.m[2]=t[2],this.m[3]=t[3],this},negate:function(){return this.m[0]=-this.m[0],this.m[1]=-this.m[1],this.m[2]=-this.m[2],this.m[3]=-this.m[3],this},negative:function(){var t=new e(-this.m[0],-this.m[1],-this.m[2],-this.m[3]);return t},multiplyScalar:function(t){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=t,this.m[3]*=t,this},addVectors:function(t,e){return this.m[0]=t.m[0]+e.m[0],this.m[1]=t.m[1]+e.m[1],this.m[2]=t.m[2]+e.m[2],this.m[3]=t.m[3]+e.m[3],this},subVectors:function(t,e){return this.m[0]=t.m[0]-e.m[0],this.m[1]=t.m[1]-e.m[1],this.m[2]=t.m[2]-e.m[2],this.m[3]=t.m[3]-e.m[3],this},length:function(){var t=this.m[0],e=this.m[1],i=this.m[2],n=this.m[3],r=Math.sqrt(t*t+e*e+i*i+n*n);return r},lengthSquared:function(){var t=this.m[0],e=this.m[1],i=this.m[2],n=this.m[3],r=t*t+e*e+i*i+n*n;return r},normalize:function(){var t=this.m[0],e=this.m[1],i=this.m[2],n=this.m[3],r=1/Math.sqrt(t*t+e*e+i*i+n*n);return this.m[0]*=r,this.m[1]*=r,this.m[2]*=r,this},normalized:function(){var t=this.m[0],i=this.m[1],n=this.m[2],r=this.m[3],s=1/Math.sqrt(t*t+i*i+n*n);return new e(t*s,i*s,n*s,r*s)},distance:function(t){var e=t.m[0]-this.m[0],i=t.m[1]-this.m[1],n=t.m[2]-this.m[2],r=t.m[3]-this.m[3],s=Math.sqrt(e*e+i*i+n*n+r*r);return s},distanceSquared:function(t){var e=t.m[0]-this.m[0],i=t.m[1]-this.m[1],n=t.m[2]-this.m[2],r=t.m[3]-this.m[4],s=e*e+i*i+n*n+r*r;return s}},e.create=function(t,i,n,r){var s=new e(t,i,n,r);return s},e.createV=function(){var t=GNOCCHI.parseFloat4([].slice.call(arguments)),i=new e(t[0],t[1],t[2],t[3]);return i},t.Vec4=e,t}(GNOCCHI),GNOCCHI=function(t){var e=function(t,e,i,n,r,s,a,o,h,u,c,m,f,l,d,v){this.m=new Float32Array(16);var p=this.m;16==arguments.length?(p[0]=t,p[4]=e,p[8]=i,p[12]=n,p[1]=r,p[5]=s,p[9]=a,p[13]=o,p[2]=h,p[6]=u,p[10]=c,p[14]=m,p[3]=f,p[7]=l,p[11]=d,p[15]=v):(p[0]=1,p[4]=0,p[8]=0,p[12]=0,p[1]=0,p[5]=1,p[9]=0,p[13]=0,p[2]=0,p[6]=0,p[10]=1,p[14]=0,p[3]=0,p[7]=0,p[11]=0,p[15]=1)};return e.prototype={constructor:e,clone:function(){var t=this.m,i=new e(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]);return i},copy:function(t){var e=this.m,i=t.m;return e[0]=i[0],e[4]=i[4],e[8]=i[8],e[12]=i[12],e[1]=i[1],e[5]=i[5],e[9]=i[9],e[13]=i[13],e[2]=i[2],e[6]=i[6],e[10]=i[10],e[14]=i[14],e[3]=i[3],e[7]=i[7],e[11]=i[11],e[15]=i[15],this},set:function(t,e,i,n,r,s,a,o,h,u,c,m,f,l,d,v){var p=this.m;return p[0]=t,p[4]=e,p[8]=i,p[12]=n,p[1]=r,p[5]=s,p[9]=a,p[13]=o,p[2]=h,p[6]=u,p[10]=c,p[14]=m,p[3]=f,p[7]=l,p[11]=d,p[15]=v,this},identity:function(){var t=this.m;return t[0]=1,t[4]=0,t[8]=0,t[12]=0,t[1]=0,t[5]=1,t[9]=0,t[13]=0,t[2]=0,t[6]=0,t[10]=1,t[14]=0,t[3]=0,t[7]=0,t[11]=0,t[15]=1,this},transformVec3:function(t){var e=this.m,i=e[0]*t.x+e[4]*t.y+e[8]*t.z,n=e[1]*t.x+e[5]*t.y+e[9]*t.z,r=e[2]*t.x+e[6]*t.y+e[10]*t.z,s=new Vec3(i,n,r);return s},calcTransformVec3:function(t,e){var i=this.m;e.x=i[0]*t.x+i[4]*t.y+i[8]*t.z,e.y=i[1]*t.x+i[5]*t.y+i[9]*t.z,e.z=i[2]*t.x+i[6]*t.y+i[10]*t.z},transpose:function(){var t,e=this.m;t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t},inverted:function(){var t=new e,i=this.m,n=i[0]*i[5]-i[1]*i[4],r=i[0]*i[6]-i[2]*i[4],s=i[0]*i[7]-i[3]*i[4],a=i[1]*i[6]-i[2]*i[5],o=i[1]*i[7]-i[3]*i[5],h=i[2]*i[7]-i[3]*i[6],u=i[8]*i[13]-i[9]*i[12],c=i[8]*i[14]-i[10]*i[12],m=i[8]*i[15]-i[11]*i[12],f=i[9]*i[14]-i[10]*i[13],l=i[9]*i[15]-i[11]*i[13],d=i[10]*i[15]-i[11]*i[14],v=n*d-r*l+s*f+a*m-o*c+h*u;if(Math.abs(v)>1e-9){t.clientData[0]=+i[5]*d-i[6]*l+i[7]*f,t.clientData[4]=-i[4]*d+i[6]*m-i[7]*c,t.clientData[8]=+i[4]*l-i[5]*m+i[7]*u,t.clientData[12]=-i[4]*f+i[5]*c-i[6]*u,t.clientData[1]=-i[1]*d+i[2]*l-i[3]*f,t.clientData[5]=+i[0]*d-i[2]*m+i[3]*c,t.clientData[9]=-i[0]*l+i[1]*m-i[3]*u,t.clientData[13]=+i[0]*f-i[1]*c+i[2]*u,t.clientData[2]=+i[13]*h-i[14]*o+i[15]*a,t.clientData[6]=-i[12]*h+i[14]*s-i[15]*r,t.clientData[10]=+i[12]*o-i[13]*s+i[15]*n,t.clientData[14]=-i[12]*a+i[13]*r-i[14]*n,t.clientData[3]=-i[9]*h+i[10]*o-i[11]*a,t.clientData[7]=+i[8]*h-i[10]*s+i[11]*r,t.clientData[11]=-i[8]*o+i[9]*s-i[11]*n,t.clientData[15]=+i[8]*a-i[9]*r+i[10]*n;var p=1/v;t.clientData[0]*=p,t.clientData[1]*=p,t.clientData[2]*=p,t.clientData[3]*=p,t.clientData[4]*=p,t.clientData[5]*=p,t.clientData[6]*=p,t.clientData[7]*=p,t.clientData[8]*=p,t.clientData[9]*=p,t.clientData[10]*=p,t.clientData[11]*=p,t.clientData[12]*=p,t.clientData[13]*=p,t.clientData[14]*=p,t.clientData[15]*=p}return t},invert:function(){var t=this.inverted();return this.copy(t),this},setPerspective:function(t,e,i,n){var r=Math.fround(i*Math.tan(t/2*Math.PI/180)),s=Math.fround(-r),a=Math.fround(e*r),o=Math.fround(-a),h=Math.fround(i),u=Math.fround(n),c=Math.fround(a-o),m=Math.fround(r-s),f=Math.fround(u-h),l=this.m;return l[0]=2*h/c,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=2*h/m,l[6]=0,l[7]=0,l[8]=(a+o)/c,l[9]=(r+s)/m,l[10]=-(u+h)/f,l[11]=-1,l[12]=0,l[13]=0,l[14]=-(2*u*h)/f,l[15]=0,this},translate:function(t){var i=this.clone(),n=e.createTranslate(t);return e.multiply(i,n,this),this},rotate:function(t){var i=this.clone(),n=e.createRotation(t);return e.multiply(i,n,this),this},scale:function(t){var i=this.clone(),n=e.createScale(t);return e.multiply(i,n,this),this},makeRotationFromEuler:function(t){var e=this.m,i=Math.fround(t.x),n=Math.fround(t.y),r=Math.fround(t.z),s=Math.fround(Math.cos(i)),a=Math.fround(Math.sin(i)),o=Math.fround(Math.cos(n)),h=Math.fround(Math.sin(n)),u=Math.fround(Math.cos(r)),c=Math.fround(Math.sin(r));if("XYZ"===t.order){var m=s*u,f=s*c,l=a*u,d=a*c;e[0]=o*u,e[4]=-o*c,e[8]=h,e[1]=f+l*h,e[5]=m-d*h,e[9]=-a*o,e[2]=d-m*h,e[6]=l+f*h,e[10]=s*o}else if("YXZ"===t.order){var v=o*u,p=o*c,g=h*u,G=h*c;e[0]=v+G*a,e[4]=g*a-p,e[8]=s*h,e[1]=s*c,e[5]=s*u,e[9]=-a,e[2]=p*a-g,e[6]=G+v*a,e[10]=s*o}else if("ZXY"===t.order){var v=o*u,p=o*c,g=h*u,G=h*c;e[0]=v-G*a,e[4]=-s*c,e[8]=g+p*a,e[1]=p+g*a,e[5]=s*u,e[9]=G-v*a,e[2]=-s*h,e[6]=a,e[10]=s*o}else if("ZYX"===t.order){var m=s*u,f=s*c,l=a*u,d=a*c;e[0]=o*u,e[4]=l*h-f,e[8]=m*h+d,e[1]=o*c,e[5]=d*h+m,e[9]=f*h-l,e[2]=-h,e[6]=a*o,e[10]=s*o}else if("YZX"===t.order){var y=s*o,C=s*h,L=a*o,x=a*h;e[0]=o*u,e[4]=x-y*c,e[8]=L*c+C,e[1]=c,e[5]=s*u,e[9]=-a*u,e[2]=-h*u,e[6]=C*c+L,e[10]=y-x*c}else if("XZY"===t.order){var y=s*o,C=s*h,L=a*o,x=a*h;e[0]=o*u,e[4]=-c,e[8]=h*u,e[1]=y*c+x,e[5]=s*u,e[9]=C*c-L,e[2]=L*c-C,e[6]=a*u,e[10]=x*c+y}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},e.create=function(t,i,n,r,s,a,o,h,u,c,m,f,l,d,v,p){var g=null;return g=16==arguments.length?new e(t,i,n,r,s,a,o,h,u,c,m,f,l,d,v,p):new e},e.createPerspective=function(t,i,n,r){var s=new e;return s.setPerspective(t,i,n,r,s),s},e.createTranslate=function(t){var i=new e;return i.m[12]=t.x,i.m[13]=t.y,i.m[14]=t.z,i.m[15]=1,i},e.createRotation=function(t){var i=new e,n=Math.cos(t.x),r=Math.cos(t.y),s=Math.cos(t.z),a=Math.sin(t.x),o=Math.sin(t.y),h=Math.sin(t.z);return i.m[0]=s*r,i.m[1]=h*r,i.m[2]=-o,i.m[3]=0,i.m[4]=-h*n+s*o*a,i.m[5]=s*n+h*o*a,i.m[6]=r*a,i.m[7]=0,i.m[8]=h*a+s*o*n,i.m[9]=-s*a+h*o*n,i.m[10]=r*n,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0,i.m[15]=1,i},e.createScale=function(t){var i=new e;return t instanceof GNOCCHI.Vec3?(i.m[0]=t.x,i.m[5]=t.y,i.m[10]=t.z,i.m[15]=1):(i.m[0]=t,i.m[5]=t,i.m[10]=t,i.m[15]=1),i},e.multiply=function(t,e,i){var n=t.m,r=e.m;i.m[0]=n[0]*r[0]+n[4]*r[1]+n[8]*r[2]+n[12]*r[3],i.m[1]=n[1]*r[0]+n[5]*r[1]+n[9]*r[2]+n[13]*r[3],i.m[2]=n[2]*r[0]+n[6]*r[1]+n[10]*r[2]+n[14]*r[3],i.m[3]=n[3]*r[0]+n[7]*r[1]+n[11]*r[2]+n[15]*r[3],i.m[4]=n[0]*r[4]+n[4]*r[5]+n[8]*r[6]+n[12]*r[7],i.m[5]=n[1]*r[4]+n[5]*r[5]+n[9]*r[6]+n[13]*r[7],i.m[6]=n[2]*r[4]+n[6]*r[5]+n[10]*r[6]+n[14]*r[7],i.m[7]=n[3]*r[4]+n[7]*r[5]+n[11]*r[6]+n[15]*r[7],i.m[8]=n[0]*r[8]+n[4]*r[9]+n[8]*r[10]+n[12]*r[11],i.m[9]=n[1]*r[8]+n[5]*r[9]+n[9]*r[10]+n[13]*r[11],i.m[10]=n[2]*r[8]+n[6]*r[9]+n[10]*r[10]+n[14]*r[11],i.m[11]=n[3]*r[8]+n[7]*r[9]+n[11]*r[10]+n[15]*r[11],i.m[12]=n[0]*r[12]+n[4]*r[13]+n[8]*r[14]+n[12]*r[15],i.m[13]=n[1]*r[12]+n[5]*r[13]+n[9]*r[14]+n[13]*r[15],i.m[14]=n[2]*r[12]+n[6]*r[13]+n[10]*r[14]+n[14]*r[15],i.m[15]=n[3]*r[12]+n[7]*r[13]+n[11]*r[14]+n[15]*r[15]},t.Matrix44=e,t}(GNOCCHI),GNOCCHI=function(t){var e=function(t,i,n,r){this._x=t||0,this._y=i||0,this._z=n||0,this._order=r||e.DefaultOrder};return e.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],e.DefaultOrder="XYZ",e.prototype={constructor:e,_x:0,_y:0,_z:0,_order:e.DefaultOrder,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get order(){return this._order},set order(t){this._order=t,this.onChangeCallback()},set:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._order=n||this._order,this.onChangeCallback(),this},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e){var i=Math.clamp,n=t.elements,r=n[0],s=n[4],a=n[8],o=n[1],h=n[5],u=n[9],c=n[2],m=n[6],f=n[10];return e=e||this._order,"XYZ"===e?(this._y=Math.asin(i(a,-1,1)),.99999>Math.abs(a)?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(m,h),this._z=0)):"YXZ"===e?(this._x=Math.asin(-i(u,-1,1)),.99999>Math.abs(u)?(this._y=Math.atan2(a,f),this._z=Math.atan2(o,h)):(this._y=Math.atan2(-c,r),this._z=0)):"ZXY"===e?(this._x=Math.asin(i(m,-1,1)),.99999>Math.abs(m)?(this._y=Math.atan2(-c,f),this._z=Math.atan2(-s,h)):(this._y=0,this._z=Math.atan2(o,r))):"ZYX"===e?(this._y=Math.asin(-i(c,-1,1)),.99999>Math.abs(c)?(this._x=Math.atan2(m,f),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,h))):"YZX"===e?(this._z=Math.asin(i(o,-1,1)),.99999>Math.abs(o)?(this._x=Math.atan2(-u,h),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(a,f))):"XZY"===e?(this._z=Math.asin(-i(s,-1,1)),.99999>Math.abs(s)?(this._x=Math.atan2(m,h),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-u,f),this._y=0)):console.warn("Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){},clone:function(){return new e(this._x,this._y,this._z,this._order)}},t.Euler=e,t}(GNOCCHI),GNOCCHI=function(t){var e=function(t,e,i,n){this.m=new Float32Array([t||0,e||0,i||0,n||0])};return e.prototype={constructor:e,get x(){return this.m[0]},set x(t){this.m[0]=t},get y(){return this.m[1]},set y(t){this.m[1]=t},get z(){return this.m[2]},set z(t){this.m[2]=t},get w(){return this.m[3]},set w(t){this.m[3]=t},copy:function(t){return this.m[0]=t.m[0],this.m[1]=t.m[1],this.m[2]=t.m[2],this.m[3]=t.m[3],this},set:function(t,e,i,n){return this.m[0]=t,this.m[1]=e,this.m[2]=i,this.m[3]=n,this},setV:function(){var t=GNOCCHI.parseFloat4([].slice.call(arguments));return this.m[0]=t[0],this.m[1]=t[1],this.m[2]=t[2],this.m[3]=t[3],this}},e.creat=function(t,i,n,r){var s=new e(t,i,n,r);return s},e.createV=function(){var t=GNOCCHI.parseFloat4([].slice.call(arguments));return new e(t[0],t[1],t[2],t[3]),this},t.Quaternion=e,t}(GNOCCHI),GNOCCHI=function(e){var i=function(t,e,i,n){this.l=Math.fround(0),this.r=Math.fround(0),this.b=Math.fround(0),this.t=Math.fround(0),this.n=Math.fround(0),this.f=Math.fround(0);var r=Math.fround(.1),s=Math.fround(1e4);i!==void 0&&(r=Math.fround(i)),n===void 0&&(s=Math.fround(n)),this.set(t,e,i,n)};return i.prototype={constructor:i,set:function(t,e,i,n){this.t=Math.fround(i*Math.tan(t/2*Math.PI/180)),this.b=Math.fround(-this.t),this.r=Math.fround(e*this.t),this.l=Math.fround(-this.r),this.n=Math.fround(i),this.f=Math.fround(n)},getWidth:function(){var t=r-l;return t},getHeight:function(){var e=t-b;return e},getDepth:function(){var t=f-n;return t}},i.create=function(t,e){var n=new i(t,e);return n},i.createWithNearFar=function(t,e,n,r){var s=new i(t,e,n,r);return s},e.Frustum=i,e}(GNOCCHI),GNOCCHI=function(t){var e=t,i=function(t){if(this.pixelWidth=Math.fround(300),this.pixelHeight=Math.fround(150),this.aspectRatio=Math.fround(this.pixelWidth/this.pixelHeight),this.pixelAligned=!1,this.upperLeftOrigin=!1,this.fovDegrees=Math.fround(60),this.nearPlane=Math.fround(.1),this.farPlane=Math.fround(1e4),this.eyePoint=new e.Vec3(0,0,1),this.target=new e.Vec3(0,0,0),this.viewDir=new e.Vec3(0,0,-1),this.normalizedViewDir=new e.Vec3(0,0,-1),this.worldUp=new e.Vec3(0,1,0),this.modelViewMatrix=new e.Matrix44,this.projectionMatrix=new e.Matrix44,this.modelViewProjectionMatrix=new e.Matrix44,this.u=new e.Vec3,this.v=new e.Vec3,this.w=new e.Vec3,this.frustum=new e.Frustum(this.fovDegrees,this.aspectRatio,this.nearPlane,this.farPlane),this.nearTL=new e.Vec3,this.nearTR=new e.Vec3,this.nearBL=new e.Vec3,this.nearBR=new e.Vec3,this.farTL=new e.Vec3,this.farTR=new e.Vec3,this.farBL=new e.Vec3,this.farBR=new e.Vec3,this.setPropertyValues(t),this.aspectRatio=this.pixelWidth/this.pixelHeight,this.pixelAligned){var i=Math.fround(this.pixelWidth/2),n=Math.fround(this.pixelHeight/2),r=Math.fround(3.14159/180*(this.fovDegrees/2)),s=Math.fround(Math.tan(r)),a=Math.fround(n/s);this.nearPlane=Math.fround(a/10),this.farPlane=Math.fround(10*a),"nearPlane"in t&&(this.nearPlane=Math.fround(t.nearPlane)),"farPlane"in t&&(this.farPlane=Math.fround(t.farPlane)),this.setPerspective(this.fovDegrees,this.aspectRatio,this.nearPlane,this.farPlane),this.lookAt(e.Vec3.create(i,n,a),e.Vec3.create(i,n,0))}else this.setPerspective(this.fovDegrees,this.aspectRatio,this.nearPlane,this.farPlane),this.lookAt(this.eyePoint,this.target)};return i.prototype={constructor:i,setPropertyValues:function(t){if(void 0!=t)for(var e in t){var i=t[e];if(void 0!=i&&e in this){var n=this[e];n instanceof GNOCCHI.Vec3?n.copy(i):this[e]=i}}},mv:function(){return this.modelViewMatrix},mvp:function(){return this.modelViewProjectionMatrix},updateModelView:function(){this.w=this.viewDir.negative().normalized(),this.u.cross(this.worldUp,this.w),this.v.cross(this.w,this.u);var t=new e.Vec3(-this.eyePoint.dot(this.u),-this.eyePoint.dot(this.v),-this.eyePoint.dot(this.w));this.modelViewMatrix.set(this.u.x,this.u.y,this.u.z,t.x,this.v.x,this.v.y,this.v.z,t.y,this.w.x,this.w.y,this.w.z,t.z,0,0,0,1),this.upperLeftOrigin&&(this.modelViewMatrix.scale(new e.Vec3(1,-1,1)),this.modelViewMatrix.translate(new e.Vec3(0,-this.pixelHeight,0)))},updateProjection:function(){this.frustum.set(this.fovDegrees,this.aspectRatio,this.nearPlane,this.farPlane),this.projectionMatrix.setPerspective(this.fovDegrees,this.aspectRatio,this.nearPlane,this.farPlane)},updateModelViewProjection:function(){e.Matrix44.multiply(this.projectionMatrix,this.modelViewMatrix,this.modelViewProjectionMatrix)},updateClipPlaneCoords:function(){function t(t,e,i,n,r,s,a,o,h){h.x=t.x+o*r*e.x+o*s*i.x+a*n.x,h.y=t.y+o*r*e.y+o*s*i.y+a*n.y,h.z=t.z+o*r*e.z+o*s*i.z+a*n.z}var e=this.eyePoint,i=this.u,n=this.v,r=this.normalizedViewDir,s=this.frustum,a=this.nearPlane,o=this.farPlane,h=o/a;t(e,i,n,r,s.l,s.t,a,1,this.nearTL),t(e,i,n,r,s.r,s.t,a,1,this.nearTR),t(e,i,n,r,s.l,s.b,a,1,this.nearBL),t(e,i,n,r,s.r,s.b,a,1,this.nearBR),t(e,i,n,r,s.l,s.t,o,h,this.farTL),t(e,i,n,r,s.r,s.t,o,h,this.farTR),t(e,i,n,r,s.l,s.b,o,h,this.farBL),t(e,i,n,r,s.r,s.b,o,h,this.farBR)},lookAt:function(t,e){this.eyePoint=t,this.target=e,this.viewDir.subVectors(e,t),this.normalizedViewDir.copy(this.viewDir),this.normalizedViewDir.normalize(),this.updateModelView(),this.updateModelViewProjection(),this.updateClipPlaneCoords()},setPerspective:function(t,e,i,n){this.fovDegrees=Math.fround(t),this.aspectRatio=Math.fround(e),this.nearPlane=Math.fround(i),this.farPlane=Math.fround(n),this.frustum.set(t,e,i,n),this.updateProjection(),this.updateModelViewProjection(),this.updateClipPlaneCoords()},pointOnFrustumTop:function(t,e){var i=Vec3.mix(this.nearTL,this.farTL,e),n=Vec3.mix(this.nearTR,this.farTR,e),r=Vec3.mixed(i,n,t);return r},pointOnFrustumBottom:function(t,e){var i=Vec3.mix(this.nearBL,this.farBL,e),n=Vec3.mix(this.nearBR,this.farBR,e),r=Vec3.mixed(i,n,t);return r}},t.CameraPersp=i,t}(GNOCCHI),GNOCCHI=function(t){var e=t,i=function(t,i,n){this.texture=e.GL.createTexture(),this.boundUnit=-1;var t=t||1,i=i||1,r=e.GL.UNSIGNED_BYTE;if(n!==void 0&&"dataType"in n&&(r=n.dataType),e.GL.bindTexture(e.GL.TEXTURE_2D,this.texture),e.GL.texParameteri(e.GL.TEXTURE_2D,e.GL.TEXTURE_WRAP_S,e.GL.CLAMP_TO_EDGE),e.GL.texParameteri(e.GL.TEXTURE_2D,e.GL.TEXTURE_WRAP_T,e.GL.CLAMP_TO_EDGE),e.GL.texParameteri(e.GL.TEXTURE_2D,e.GL.TEXTURE_MIN_FILTER,e.GL.LINEAR),e.GL.texParameteri(e.GL.TEXTURE_2D,e.GL.TEXTURE_MAG_FILTER,e.GL.LINEAR),1==t&&1==i){var s=new Uint8Array([0,0,0,0]);e.GL.texImage2D(e.GL.TEXTURE_2D,0,e.GL.RGBA,t,i,0,e.GL.RGBA,r,s)}else e.GL.texImage2D(e.GL.TEXTURE_2D,0,e.GL.RGBA,t,i,0,e.GL.RGBA,r,null);e.GL.bindTexture(e.GL.TEXTURE_2D,null)};return i.boundTexUnits=function(){for(var t=Array(32),e=0;t.length>e;++e)t[e]=!1;return t}(),i.nextTexUnit=function(){for(var t=-1,e=0;i.boundTexUnits.length>e;++e)if(!1===i.boundTexUnits[e]){t=e;break}return t},i.prototype={constructor:i,bind:function(t){return this.boundUnit=t===void 0?i.nextTexUnit():t,e.GL.activeTexture(e.GL.TEXTURE0+this.boundUnit),e.GL.bindTexture(e.GL.TEXTURE_2D,this.texture),i.boundTexUnits[this.boundUnit]=!0,this.boundUnit},unbind:function(){e.GL.bindTexture(e.GL.TEXTURE_2D,null),i.boundTexUnits[this.boundUnit]=!1},texImage2D:function(t){e.GL.bindTexture(e.GL.TEXTURE_2D,this.texture),e.GL.texImage2D(e.GL.TEXTURE_2D,0,e.GL.RGB,e.GL.RGB,e.GL.UNSIGNED_BYTE,t),e.GL.bindTexture(e.GL.TEXTURE_2D,null)},texImage2DFromArray:function(t,i,n,r){var s=e.GL.UNSIGNED_BYTE;r instanceof Float32Array&&(s=e.GL.FLOAT),e.GL.bindTexture(e.GL.TEXTURE_2D,this.texture),e.GL.texImage2D(e.GL.TEXTURE_2D,0,n,t,i,0,n,s,r),e.GL.bindTexture(e.GL.TEXTURE_2D,null)},texImage2DFromArrayRGB:function(t,i,n){this.texImage2DFromArray(t,i,e.GL.RGB,n)},texImage2DFromArrayRGBA:function(t,i,n){this.texImage2DFromArray(t,i,e.GL.RGBA,n)}},i.create=function(t){var e=new i;if(t!==void 0){var n=new Image;n.onload=function(){e.texImage2D(n)},n.src=t}return e},i.createFromArray=function(t,n,r,s){var a=new i,o=e.GL.UNSIGNED_BYTE;return s instanceof Float32Array&&(o=e.GL.FLOAT),e.GL.bindTexture(e.GL.TEXTURE_2D,a.texture),e.GL.texImage2D(e.GL.TEXTURE_2D,0,r,t,n,0,r,o,s),e.GL.bindTexture(e.GL.TEXTURE_2D,null),a},i.createFromArrayRGB=function(t,n,r){var s=i.createFromArray(t,n,e.GL.RGB,r);return s},i.createFromArrayRGBA=function(t,n,r){var s=i.createFromArray(t,n,e.GL.RGBA,r);return s},t.Texture2D=i,t}(GNOCCHI),GNOCCHI=function(t){var e=t,i=function(t,i,n){this.width=t,this.height=i,this.framebuffer=e.GL.createFramebuffer();var r=e.GL.UNSIGNED_BYTE;n!==void 0&&"dataType"in n&&(r=n.dataType),e.GL.bindFramebuffer(e.GL.FRAMEBUFFER,this.framebuffer),this.colorBuffer=new e.Texture2D(this.width,this.height,{dataType:r}),e.GL.framebufferTexture2D(e.GL.FRAMEBUFFER,e.GL.COLOR_ATTACHMENT0,e.GL.TEXTURE_2D,this.colorBuffer.texture,0),n!==void 0&&"enableDepth"in n&&(this.depthBuffer=e.GL.createRenderbuffer(),e.GL.bindRenderbuffer(e.GL.RENDERBUFFER,this.depthBuffer),e.GL.renderbufferStorage(e.GL.RENDERBUFFER,e.GL.DEPTH_COMPONENT16,this.width,this.height),e.GL.bindRenderbuffer(e.GL.RENDERBUFFER,null),e.GL.framebufferRenderbuffer(e.GL.FRAMEBUFFER,e.GL.DEPTH_ATTACHMENT,e.GL.RENDERBUFFER,this.depthBuffer)),e.GL.bindFramebuffer(e.GL.FRAMEBUFFER,null)};return i.prototype={constructor:i,bind:function(){e.GL.bindFramebuffer(e.GL.FRAMEBUFFER,this.framebuffer)},unbind:function(){e.GL.bindFramebuffer(e.GL.FRAMEBUFFER,null)},getWidth:function(){return this.width},getHeight:function(){return this.height},getTexture:function(){return this.colorBuffer}},i.create=function(t,e,n){var r=new i(t,e,n);return r},t.RenderTarget=i,t}(GNOCCHI),GNOCCHI=function(t){var e=t,i=function(t,n){if(n===void 0)throw"(GNOCCHI.Shader) parameter 'shaderSrc' is undefined";if(this.shader=e.GL.createShader(t),this.shaderType=t,this.shaderTypeStr="",e.GL.VERTEX_SHADER==t?this.typeStr="VERT":e.GL.FRAGMENT_SHADER==t&&(this.typeStr="FRAG"),e.GL.shaderSource(this.shader,n),e.GL.compileShader(this.shader),!e.GL.getShaderParameter(this.shader,e.GL.COMPILE_STATUS)){var r="(GNOCCHI.Shader) ["+this.shaderTypeStr+"] Shader compile failed: "+e.GL.getShaderInfoLog(this.shader);throw r+=i.Util.addLineNumbers(n),e.GL.deleteShader(this.shader),r}};return i.prototype={constructor:i,destroy:function(){e.GL.deleteShader(this.shader)}},i.createVertexShader=function(t){var n=new i(e.GL.VERTEX_SHADER,t);return n},i.createFragmentShader=function(t){var n=new i(e.GL.FRAGMENT_SHADER,t);return n},i.Util={},i.Util.addLineNumbers=function(t){for(var e=t.split("\n"),i=0;e.length>i;i++)e[i]=i+1+": "+e[i];return e.join("\n")},i.Util.loadSource=function(t){var e=document.getElementById(t);if(!e)return null;for(var i="",n=e.firstChild;n;)3==n.nodeType&&(i+=n.textContent),n=n.nextSibling;return i},i.loadSource=i.Util.loadSource,t.Shader=i,t}(GNOCCHI),GNOCCHI=function(t){var e=t,i=function(t,i){if(this.vertexShader=e.Shader.createVertexShader(t),this.fragmentShader=e.Shader.createFragmentShader(i),this.program=e.GL.createProgram(),e.GL.attachShader(this.program,this.vertexShader.shader),e.GL.attachShader(this.program,this.fragmentShader.shader),e.GL.linkProgram(this.program),!e.GL.getProgramParameter(this.program,e.GL.LINK_STATUS)){var n="(GNOCCHI.GlslProg) Program link failed: "+e.GL.getProgramInfoLog(this.program);throw e.GL.deleteProgram(this.program),n}this.boundTextures={}};return i.prototype={constructor:i,destroy:function(){e.GL.deleteProgram(this.program)},bind:function(){e.GL.useProgram(this.program)},unbind:function(){for(var t in this.boundTextures)this.boundTextures[t].unbind();
this.boundTextures={}},attribLocation:function(t){var i=e.GL.getAttribLocation(this.program,t);return i},uniformLocation:function(t){var i=e.GL.getUniformLocation(this.program,t);return i},uniform:function(t,i){var n=this.uniformLocation(t);if(null!=n)if(i instanceof GNOCCHI.Matrix44)e.GL.uniformMatrix4fv(n,!1,i.m);else if(i instanceof GNOCCHI.Vec2)e.GL.uniform2f(n,i.m[0],i.m[1]);else if(i instanceof GNOCCHI.Vec3)e.GL.uniform3f(n,i.m[0],i.m[1],i.m[2]);else if(i instanceof GNOCCHI.Color)e.GL.uniform3f(n,i.m[0],i.m[1],i.m[2]);else if(i instanceof GNOCCHI.ColorA)e.GL.uniform4f(n,i.m[0],i.m[1],i.m[2],i.m[3]);else if(i instanceof GNOCCHI.Texture2D){var r=i.bind();e.GL.uniform1i(n,r),this.boundTextures[r]=i}else e.GL.uniform1f(n,i)}},i.createById=function(t,n){var r=null;try{var s=e.Shader.loadSource(t),a=e.Shader.loadSource(n);r=new i(s,a),console.log("HDBG: Successfully created shader from '"+t+"' and '"+n+"'")}catch(o){throw"GlslProg Failed: "+o}return r},i.createFromSource=function(t,e){var n=new i(t,e);return n},t.GlslProg=i,t}(GNOCCHI),GNOCCHI=function(t){var e=t,i=function(t,i){this.vbo=e.GL.createBuffer(),this.target=t,i!==void 0&&(this.bind(),this.bufferData(i),this.unbind())};return i.prototype={constructor:i,destroy:function(){e.GL.deleteBuffer(this.vbo)},bind:function(){e.GL.bindBuffer(this.target,this.vbo)},unbind:function(){e.GL.bindBuffer(this.target,null)},bufferData:function(t){e.GL.bufferData(this.target,t,e.GL.STATIC_DRAW)},bufferSubData:function(t){e.GL.bufferSubData(this.target,0,t)},enable:function(t){e.GL.enableVertexAttribArray(t)},set:function(t,i){e.GL.vertexAttribPointer(t,i,e.GL.FLOAT,!1,0,0)},setAndEnable:function(t,e){this.set(t,e),this.enable(t)},instanceDivisor:function(t,i){e.GL.vertexAttribDivisor(t,i)}},i.createBuffer=function(t){var n=new i(e.GL.ARRAY_BUFFER,t);return n},i.createIndexBuffer=function(t){var n=new i(e.GL.ELEMENT_ARRAY_BUFFER,t);return n},t.Vbo=i,t}(GNOCCHI),GNOCCHI=function(t){var e=t,i=function(){this.vao=e.GL.createVertexArray()};return i.prototype={contructor:i,destroy:function(){e.GL.deleteVertexArray(this.vao)},bind:function(){e.GL.bindVertexArray(this.vao)},unbind:function(){e.GL.bindVertexArray(null)}},i.create=function(){var t=new i;return t},t.Vao=i,t}(GNOCCHI),GNOCCHI=function(t){var e=t,i=function(t){this.positionSize=t||3,this.indices=i.IndexVertexData.create(),this.positions=i.FloatVertexData.create(),this.uvs=i.FloatVertexData.create(),this.normals=i.FloatVertexData.create(),this.colors=i.FloatVertexData.create(),this.vao=e.Vao.create(),this.shaderProgram=null,this.numActiveVertices=0,this.attribLocations={position:-1,uv:-1,normal:-1,color:-1}};return i.prototype={constructor:i,getNumActiveIndices:function(){return this.numActiveVertices},setNumActiveIndices:function(t){this.numActiveVertices=t},setIndices:function(t){t.length>0&&(this.indices.setData(t),this.numActiveVertices=t.length)},getNumPositions:function(){var t=this.positions.clientData.length/this.positionSize;return t},setPositions:function(t){t.length>0&&(this.positions.setData(t),this.indices.empty()&&(this.numActiveVertices=t.length/this.positionSize))},setUvs:function(t){t.length>0&&this.uvs.setData(t)},setNormals:function(t){t.length>0&&this.normals.setData(t)},setColors:function(t){t.length>0&&this.colors.setData(t)},setShaderProgram:function(t){if(this.shaderProgram=t,null==this.shaderProgram)throw"Geometry.setShaderProgram) parameter shaderProg is null";this.acquireAttribLocations(this.shaderProgram),this.enableAttribs()},acquireAttribLocations:function(t){if(t===void 0)throw"(Geometry.acquireAttribLocations) Expected a GNOCCHI.GlslProg for 'prog' parameter - but got undefined instead!";this.attribLocations.position=t.attribLocation("vPosition"),this.attribLocations.uv=t.attribLocation("vUv"),this.attribLocations.normal=t.attribLocation("vNormal"),this.attribLocations.color=t.attribLocation("vColor")},enableAttribs:function(){this.vao.bind(),null!==this.indices.gpuBuffer&&this.indices.gpuBuffer.bind(),-1!==this.attribLocations.position&&null!=this.positions.gpuBuffer&&(this.positions.gpuBuffer.bind(),this.positions.gpuBuffer.setAndEnable(this.attribLocations.position,this.positionSize)),-1!==this.attribLocations.uv&&null!=this.uvs.gpuBuffer&&(this.uvs.gpuBuffer.bind(),this.uvs.gpuBuffer.setAndEnable(this.attribLocations.uv,2)),-1!==this.attribLocations.normal&&null!=this.normals.gpuBuffer&&(this.normals.gpuBuffer.bind(),this.normals.gpuBuffer.setAndEnable(this.attribLocations.normal,3)),-1!==this.attribLocations.color&&null!=this.colors.gpuBuffer&&(this.colors.gpuBuffer.bind(),this.colors.gpuBuffer.setAndEnable(this.attribLocations.color,3)),this.vao.unbind()},update:function(){this.indices.checkedAllocate(),this.positions.checkedAllocate(),this.uvs.checkedAllocate(),this.normals.checkedAllocate(),this.colors.checkedAllocate(),this.vao.bind(),this.indices.checkedUpdate(),this.positions.checkedUpdate(),this.uvs.checkedUpdate(),this.normals.checkedUpdate(),this.colors.checkedUpdate(),this.vao.unbind()}},i.VertexData=function(t){this.clientData=t,this.gpuBuffer=null,this.dirty=!1},i.VertexData.prototype={constructor:i.VertexData},i.IndexVertexData=function(t){i.VertexData.call(this,t)},i.IndexVertexData.prototype=Object.create(i.VertexData.prototype,{empty:{value:function(){return 0==this.clientData.length}},checkedAllocate:{value:function(){this.dirty&&this.clientData.length>0&&null===this.gpuBuffer&&(this.gpuBuffer=e.Vbo.createIndexBuffer())}},checkedUpdate:{value:function(){this.dirty&&this.clientData.length>0&&(this.gpuBuffer.bind(),this.gpuBuffer.bufferData(this.clientData),this.gpuBuffer.unbind(),this.dirty=!1)}},resize:{value:function(t){this.clientData=new Uint32Array(t),this.dirty=!0}},setData:{value:function(t){null!==this.clientData&&t.length===this.clientData.length?this.clientData.set(t):this.clientData=new Uint32Array(t),this.dirty=!0}}}),i.IndexVertexData.create=function(t){var e=new i.IndexVertexData(new Uint32Array(t||0));return e},i.FloatVertexData=function(t){i.VertexData.call(this,t)},i.FloatVertexData.prototype=Object.create(i.VertexData.prototype,{empty:{value:function(){return 0==this.clientData.length}},checkedAllocate:{value:function(){this.dirty&&this.clientData.length>0&&null===this.gpuBuffer&&(this.gpuBuffer=e.Vbo.createBuffer())}},checkedUpdate:{value:function(){this.dirty&&this.clientData.length>0&&(this.gpuBuffer.bind(),this.gpuBuffer.bufferData(this.clientData),this.gpuBuffer.unbind(),this.dirty=!1)}},resize:{value:function(t){this.clientData=new Float32Array(t),this.dirty=!0}},setData:{value:function(t){null!==this.clientData&&t.length===this.clientData.length?this.clientData.set(t):this.clientData=new Float32Array(t),this.dirty=!0}}}),i.FloatVertexData.create=function(t){var e=new i.FloatVertexData(new Float32Array(t||0));return e},t.Geometry=i,t}(GNOCCHI),GNOCCHI=function(t){var e=t,i=function(){e.Geometry.call(this,2)};return i.prototype=Object.create(e.Geometry.prototype,{constructor:i,update:{value:function(){e.Geometry.prototype.update.call(this,arguments)}},draw:{value:function(){if(this.vao.bind(),this.indices.empty()){var t=Math.min(this.numActiveVertices,this.getNumPositions());e.GL.drawArrays(e.GL.TRIANGLES,0,t)}else{var t=Math.min(this.numActiveVertices,this.indices.clientData.length);e.GL.drawElements(e.GL.TRIANGLES,t,e.GL.UNSIGNED_INT,0)}this.vao.unbind()}}}),i.createRect=function(t){var e=new i;return e.setPositions([t.x1,t.y1,t.x1,t.y2,t.x2,t.y2,t.x2,t.y1]),e.setUvs([0,0,0,1,1,1,1,0]),e.setIndices([0,1,2,0,2,3]),e.update(),e.set=function(){var t=e;return function(e){if(4==arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2],s=arguments[3],a=[i,n,i,s,r,s,r,n];t.setPositions(a)}else{var a=[e.x1,e.y1,e.x1,e.y2,e.x2,e.y2,e.x2,e.y1];t.setPositions(a)}t.update()}}(),e},t.TriMesh2D=i,t}(GNOCCHI),GNOCCHI=function(t){var e=t,i=function(){e.Geometry.call(this,3)};return i.prototype=Object.create(e.Geometry.prototype,{constructor:i,update:{value:function(){e.Geometry.prototype.update.call(this,arguments)}},draw:{value:function(){if(this.vao.bind(),this.indices.empty()){var t=Math.min(this.numActiveVertices,this.getNumPositions());e.GL.drawArrays(e.GL.TRIANGLES,0,t)}else{var t=Math.min(this.numActiveVertices,this.indices.clientData.length);e.GL.drawElements(e.GL.TRIANGLES,t,e.GL.UNSIGNED_INT,0)}this.vao.unbind()}}}),i.createCube=function(t){var n=new i,r=e.Vec3.create(0,0,0),s=.5;t!==void 0&&("center"in t&&r.copy(t.center),s=t.radius||s);for(var a=[-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1],o=0;a.length/3>o;++o){var h=3*o+0,u=3*o+1,c=3*o+2;a[h]=s*a[h]+r.m[0],a[u]=s*a[u]+r.m[1],a[c]=s*a[c]+r.m[2]}return n.setPositions(a),n.setNormals([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0]),n.setColors([1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,1,1,0,1,1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1,1,0,1,1]),n.setIndices([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),n.update(),n},i.createSphere=function(t){function e(t,e){for(var i=[],n=0;t.length>n;++n)i.push(e*t[n]);return i}function n(t,e){for(var i=0;e.length>i;++i)t.push(e[i])}function r(t,e){var i=Math.sin(t)*Math.cos(e),n=Math.sin(e),r=Math.cos(t)*Math.cos(e);return[i,n,r]}var s=new i,a=16,o=8,h=!1;t!==void 0&&("center"in t&&center.copy(t.center),radius=t.radius||radius,"usegs"in t&&(a=t.usegs),"vsegs"in t&&(o=t.vsegs),"facet"in t&&(h=t.facet));var u=a+1,c=o+1,m=-Math.PI/2,f=m+2*Math.PI,l=Math.PI/2,d=-Math.PI/2,v=(f-m)/a,p=(d-l)/o,g=[],G=[],y=[],C=[],L=[];if(h)for(var x=0;o>x;++x)for(var w=0;a>w;++w){var b=m+(w+0)*v,D=l+(x+0)*p,M=m+(w+1)*v,I=l+(x+1)*p,_=r(b,D),N=r(b,I),T=r(M,I),A=r(M,D),E=[(w+0)/a,(x+0)/o],V=[(w+0)/a,(x+1)/o],O=[(w+1)/a,(x+1)/o],P=[(w+1)/a,(x+0)/o],H=(_[0]+N[0]+T[0]+A[0])/4,R=(_[1]+N[1]+T[1]+A[1])/4,S=(_[2]+N[2]+T[2]+A[2])/4,F=1/Math.sqrt(H*H+R*R+S*S),B=[F*H,F*R,F*S],U=[1,0,0];n(G,e(_,radius)),n(G,e(N,radius)),n(G,e(T,radius)),n(y,E),n(y,V),n(y,O),n(C,B),n(C,B),n(C,B),n(L,U),n(L,U),n(L,U),n(G,e(_,radius)),n(G,e(T,radius)),n(G,e(A,radius)),n(y,E),n(y,O),n(y,P),n(C,B),n(C,B),n(C,B),n(L,U),n(L,U),n(L,U)}else{for(var x=0;c>x;++x)for(var w=0;u>w;++w){var z=m+w*v,X=l+x*p,k=r(z,X),Y=k[0],q=k[1],W=k[2];n(G,[radius*Y,radius*q,radius*W]),n(y,[w/a,x/o]),n(C,[Y,q,W]),n(L,[1,0,0])}for(var x=0;o>x;++x)for(var w=0;a>w;++w){var j=(x+0)*u+(w+0),Z=(x+1)*u+(w+0),K=(x+1)*u+(w+1),Q=(x+0)*u+(w+1);g.push(j),g.push(Z),g.push(K),g.push(j),g.push(K),g.push(Q)}}return s.setIndices(g),s.setPositions(G),s.setUvs(y),s.setNormals(C),s.setColors(L),s.update(),s},i.createPlane=function(t){var n=new i,r=e.Vec3.create(0,0,0),s=1,a=1,o="Y",h=e.Color.create(1,1,1);t!==void 0&&("center"in t&&r.copy(t.center),s=t.width||s,a=t.height||a,"color"in t&&h.setV(t.color));var u=s/2,c=s/2,m=[],f=[];-1!=["Y","y","+Y","+y"].indexOf(o)?(m=[-1*u,0,-1*c,-1*u,0,1*c,1*u,0,1*c,1*u,0,-1*c],f=[0,1,0,0,1,0,0,1,0,0,1,0]):-1!=["-Y","-y"].indexOf(o)||-1!=["X","x","+X","+x"].indexOf(o)||-1!=["-X","-x"].indexOf(o)||-1!=["Z","z","+Z","+z"].indexOf(o)||-1!=["-Z","-z"].indexOf(o);for(var l=0;m.length/3>l;++l){var d=3*l+0,v=3*l+1,p=3*l+2;m[d]=m[d]+r.m[0],m[v]=m[v]+r.m[1],m[p]=m[p]+r.m[2]}return n.setPositions(m),n.setNormals(f),n.setColors([h.r,h.g,h.b,h.r,h.g,h.b,h.r,h.g,h.b,h.r,h.g,h.b]),n.setIndices([0,1,2,0,2,3]),n.update(),n},t.TriMesh3D=i,t}(GNOCCHI),GNOCCHI=function(t){var e=t,i=function(){e.Geometry.call(this,2)};return i.prototype=Object.create(e.Geometry.prototype,{constructor:i,update:{value:function(){e.Geometry.prototype.update.call(this,arguments)}},draw:{value:function(){if(this.vao.bind(),this.indices.empty()){var t=Math.min(this.numActiveVertices,this.getNumPositions());e.GL.drawArrays(e.GL.GL_LINES,0,t)}else{var t=Math.min(this.numActiveVertices,this.indices.clientData.length);e.GL.drawElements(e.GL.GL_LINES,t,e.GL.UNSIGNED_INT,0)}this.vao.unbind()}}}),i.create=function(){var t=new i;return t},i.createV=function(){var t=new LineMesh3D;return t},t.LineMesh2D=i,t}(GNOCCHI),GNOCCHI=function(t){var e=t,i=function(){e.Geometry.call(this,3)};return i.prototype=Object.create(e.Geometry.prototype,{constructor:i,update:{value:function(){e.Geometry.prototype.update.call(this,arguments)}},draw:{value:function(){if(this.vao.bind(),this.indices.empty()){var t=Math.min(this.numActiveVertices,this.getNumPositions());e.GL.drawArrays(e.GL.LINES,0,t)}else{var t=Math.min(this.numActiveVertices,this.indices.clientData.length);e.GL.drawElements(e.GL.LINES,t,e.GL.UNSIGNED_INT,0)}this.vao.unbind()}}}),i.create=function(){var t=new i;return t},i.createV=function(){var t=new i;return t},t.LineMesh3D=i,t}(GNOCCHI),GNOCCHI=function(t){var e=t,i=function(){e.Geometry.call(this,2)};return i.prototype=Object.create(e.Geometry.prototype,{constructor:i,update:{value:function(){e.Geometry.prototype.update.call(this,arguments)}},draw:{value:function(){if(this.vao.bind(),this.indices.empty()){var t=Math.min(this.numActiveVertices,this.getNumPositions());e.GL.drawArrays(e.GL.POINTS,0,t)}else{var t=Math.min(this.numActiveVertices,this.indices.clientData.length);e.GL.drawElements(e.GL.POINTS,t,e.GL.UNSIGNED_INT,0)}this.vao.unbind()}}}),i.create=function(){var t=new i;return t},i.createV=function(){var t=new i;return t},t.PointMesh2D=i,t}(GNOCCHI),GNOCCHI=function(t){var e=t,i=function(){e.Geometry.call(this,3)};return i.prototype=Object.create(e.Geometry.prototype,{constructor:i,update:{value:function(){e.Geometry.prototype.update.call(this,arguments)}},draw:{value:function(){if(this.vao.bind(),this.indices.empty()){var t=Math.min(this.numActiveVertices,this.getNumPositions());e.GL.drawArrays(e.GL.POINTS,0,t)}else{var t=Math.min(this.numActiveVertices,this.indices.clientData.length);e.GL.drawElements(e.GL.POINTS,t,e.GL.UNSIGNED_INT,0)}this.vao.unbind()}}}),i.create=function(){var t=new i;return t},i.createV=function(){var t=new i;return t},t.PointMesh3D=i,t}(GNOCCHI),GNOCCHI=function(t){var e=t,i=function(){this.geo=new e.Geometry,this.indices=new i.Data(this.geo.indices),this.positions=new i.Data(this.geo.positions),this.uvs=new i.Data(this.geo.uvs),this.normals=new i.Data(this.geo.normals),this.colors=new i.Data(this.geo.colors)};return i.Data=function(t){this.clientData=[],this.gpuBuffer=t,this.dirty=!1},i.Data.prototype={constructor:i.Data,checkedUpdate:function(){this.dirty&&(this.gpuBuffer.setData(this.clientData),this.dirty=!1)},append:function(t){this.clientData.push.apply(this.clientData,t),this.dirty=!0}},i.prototype={constructor:i,addIndices:function(t){this.indices.append(t)},addPositions:function(t){this.positions.append(t)},addUvs:function(t){this.uvs.append(t)},addNormals:function(t){this.normals.append(t)},addColors:function(t){this.colors.append(t)},update:function(){this.indices.checkedUpdate(),this.positions.checkedUpdate(),this.uvs.checkedUpdate(),this.normals.checkedUpdate(),this.colors.checkedUpdate(),this.geo.update()}},t.DynamicGeometry=i,t}(GNOCCHI),GNOCCHI=function(t){var e=function(){new Float32Array(3)};return t.DynamicTriMesh2D=e,t}(GNOCCHI),GNOCCHI=function(t){var e=function(){new Float32Array(3)};return t.DynamicTriMesh3D=e,t}(GNOCCHI),GNOCCHI=function(t){var e=function(){};return e.prototype={constructor:e},t.Anim=e,t}(GNOCCHI),GNOCCHI=function(t){var e=t,i=function(t){this.viewportX=0,this.viewportY=0,this.viewportWidth=0,this.viewportHeight=0,this.viewportCenter=e.Vec2.create(0,0),this.clearColor=e.ColorA.create(0,0,0,0),this.currentCamera=null,this.defaultShaders={},this.scratchGeo={},this.canvasParent=t;var i=this.canvasParent.getBoundingClientRect();this.canvas=document.createElement("canvas"),this.canvas.width=i.width,this.canvas.height=i.height,this.canvasParent.appendChild(this.canvas);try{var n={antialias:!0};if(this.gl=this.canvas.getContext("webgl",n),null==this.gl)throw"Unable to create WebGL context";e.GL=this.gl,console.log("HDBG: Acquired WebGL context in element: '"+this.canvasParent.id+"'"),console.log("HDBG:    WebGL context res: "+this.canvas.width+"x"+this.canvas.height)}catch(r){console.error(r)}this.loadExtensions(),this.createDefaultShaders(),console.log("HDBG: Created GNOCCHI.Renderer in element: '"+this.canvasParent.id+"'"),this.setViewport(0,0,this.canvas.width,this.canvas.height),this.setClearColor(e.ColorA.create(0,0,0,0))};return i.prototype={constructor:i,loadExtensions:function(){try{var t="OES_vertex_array_object",i=e.GL.getExtension(t);if(null==i)throw"OES_vertex_array_object is not supported on this device";e.GL.createVertexArray=function(){var t=i;return function(e){return t.createVertexArrayOES(e)}}(),e.GL.deleteVertexArray=function(){var t=i;return function(e){t.deleteVertexArrayOES(e)}}(),e.GL.isVertexArray=function(){var t=i;return function(e){t.isVertexArrayOES(e)}}(),e.GL.bindVertexArray=function(){var t=i;return function(e){t.bindVertexArrayOES(e)}}(),console.log("HDBG: Successfully loaded extension: "+t)}catch(n){console.error(n)}try{var t="ANGLE_instanced_arrays",i=e.GL.getExtension(t);if(null==i)throw"ANGLE_instanced_arrays is not supported on this device";e.GL.drawArraysInstanced=function(){var t=i;return function(e){t.drawArraysInstancedANGLE(e)}}(),e.GL.drawElementsInstanced=function(){var t=i;return function(e){t.drawElementsInstancedANGLE(e)}}(),e.GL.vertexAttribDivisor=function(){var t=i;return function(e){t.vertexAttribDivisorANGLE(e)}}(),console.log("HDBG: Successfully loaded extension: "+t)}catch(n){console.error(n)}var r=["OES_element_index_uint","OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear","WEBGL_draw_buffers"];for(var s in r)try{var t=r[s],i=e.GL.getExtension(t);if(null===i)throw t+" is not supported on this device";"OES_texture_half_float"==t&&(e.GL.HALF_FLOAT_OES=36193),console.log("HDBG: Successfully loaded extension: "+t)}catch(n){console.warn(n)}},createDefaultShaders:function(){try{this.defaultShaders.drawColor=e.GlslProg.createFromSource("attribute vec3 vPosition;\nuniform mat4 mvp;\nuniform vec3 offset;\nvoid main() {\n    gl_Position = mvp*vec4( vPosition + offset, 1.0 );\n}\n","precision mediump float;\nuniform vec3 color;\nvoid main() {\n    gl_FragColor = vec4( color, 1.0 );\n}"),console.log("HDBG: Successfully compiled GNOCCHI.Renderer.defaultShaders.drawColor")}catch(t){console.log(t)}try{this.defaultShaders.drawVertexColor=e.GlslProg.createFromSource("attribute vec3 vPosition;\nattribute vec3 vColor;\nuniform mat4 mvp;\nuniform vec3 offset;\nvarying vec3 color;\nvoid main() {\n    gl_Position = mvp*vec4( vPosition + offset, 1.0 );\n    color = vColor;\n}\n","precision mediump float;\nvarying vec3 color;\nvoid main() {\n    gl_FragColor = vec4( color, 1 );\n}"),console.log("HDBG: Successfully compiled GNOCCHI.Renderer.defaultShaders.drawVertexColor")}catch(t){console.log(t)}try{this.defaultShaders.drawTexture=e.GlslProg.createFromSource("attribute vec3 vPosition;\nattribute vec2 vUv;\nuniform mat4 mvp;\nuniform vec3 offset;\nvarying vec2 uv;\nvoid main() {\n    gl_Position = mvp*vec4( vPosition + offset, 1.0 );\n    uv = vUv;\n}","precision mediump float;\nvarying vec2 uv;\nvoid main() {\n    gl_FragColor = vec4( uv, 0.0, 1.0 );\n}"),console.log("HDBG: Successfully compiled GNOCCHI.Renderer.defaultShaders.drawTexture")}catch(t){console.log(t)}try{this.defaultShaders.drawTexture=e.GlslProg.createFromSource("attribute vec3 vPosition;\nattribute vec2 vUv;\nuniform mat4 mvp;\nuniform vec3 offset;\nvarying vec2 uv;\nvoid main() {\n    gl_Position = mvp*vec4( vPosition + offset, 1.0 );\n    uv = vUv;\n}","precision mediump float;\nuniform sampler2D tex;\nvarying vec2 uv;\nvoid main() {\n    vec4 samp = texture2D( tex, uv );\n    gl_FragColor = samp;\n}"),console.log("HDBG: Successfully compiled GNOCCHI.Renderer.defaultShaders.drawTexture")}catch(t){console.log(t)}},getCanvasWidth:function(){return this.canvas.width},getCanvasHeight:function(){return this.canvas.height},getViewportX:function(){return this.viewportX},getViewportY:function(){return this.viewportY},getViewportWidth:function(){return this.viewportWidth},getViewportHeight:function(){return this.viewportHeight},getViewportCenter:function(){return this.viewportCenter},setViewport:function(t,i,n,r){this.viewportX=t,this.viewportY=i,this.viewportWidth=n,this.viewportHeight=r,this.viewportCenter.set(t+n/2,i+r/2),e.GL.viewport(t,i,n,r)},setClearColor:function(t){var i=e.ColorA.create(0,0,0,1);t instanceof GNOCCHI.Color?(i.m[0]=t.m[0],i.m[1]=t.m[1],i.m[2]=t.m[2]):t instanceof GNOCCHI.ColorA&&(i.m[0]=t.m[0],i.m[1]=t.m[1],i.m[2]=t.m[2],i.m[3]=t.m[3]),this.clearColor.copy(i);var i=this.clearColor.m;e.GL.clearColor(i[0],i[1],i[2],i[3])},clear:function(){e.GL.clear(e.GL.COLOR_BUFFER_BIT|e.GL.DEPTH_BUFFER_BIT)},getCamera:function(){return this.currentCamera},setCamera:function(t){this.currentCamera=t},clearCamera:function(){this.currentCamera=null},enableDepthTest:function(){e.GL.enable(e.GL.DEPTH_TEST)},disableDepthTest:function(){e.GL.disable(e.GL.DEPTH_TEST)},drawRect:function(t,i){if(null!==this.currentCamera){this.scratchGeo.rect===void 0&&(this.scratchGeo.rect=e.TriMesh2D.createRect(new e.Rect(0,0,1,1))),this.scratchGeo.rect.set(t);var n=e.Color.create(1,1,1),r=null,s=e.Vec3.create(0,0,0);if(void 0!==i&&("color"in i&&n.setV(i.color),"texture"in i&&(r=i.texture),"offset"in i&&s.setV(i.offset)),r instanceof GNOCCHI.Texture2D){var a=this.defaultShaders.drawTexture;this.scratchGeo.rect.acquireAttribLocations(a),this.scratchGeo.rect.enableAttribs(),a.bind(),a.uniform("mvp",this.currentCamera.mvp()),a.uniform("offset",s),a.uniform("tex",r),this.scratchGeo.rect.draw(),a.unbind()}else{var a=this.defaultShaders.drawColor;this.scratchGeo.rect.acquireAttribLocations(a),this.scratchGeo.rect.enableAttribs(),a.bind(),a.uniform("mvp",this.currentCamera.mvp()),a.uniform("offset",s),a.uniform("color",n),this.scratchGeo.rect.draw(),a.unbind()}}}},t.Renderer=i,t}(GNOCCHI),GNOCCHI=function(t){var e=t,i=function(t){if(this.startTime=Math.fround(0),this.currentTime=Math.fround(0),this.previousTime=Math.fround(0),this.elapsedSeconds=Math.fround(0),this.elapsedFrames=0,this.fps=Math.fround(0),this.canvasParent=document.getElementById(t),null===this.canvasParent)throw"Unable to find element with id = '"+t+"'";this.renderer=new e.Renderer(this.canvasParent)};return i.prototype={constructor:i,getCanvasWidth:function(){return this.renderer.getCanvasWidth()},getCanvasHeight:function(){return this.renderer.getCanvasHeight()},setup:function(){},update:function(){},draw:function(){},mainLoop:function(t){this.currentTime=Math.fround(t),this.elapsedSeconds=(this.currentTime-this.startTime)/1e3,requestAnimationFrame(i.prototype.mainLoop.bind(this)),this.update(),this.draw(),this.elapsedFrames++,this.elapsedSeconds>0&&(this.fps=this.elapsedFrames/this.elapsedSeconds)},run:function(){this.setup(),this.mainLoop(0)}},t.App=i,t}(GNOCCHI),GNOCCHI=function(t){var e=t,i=function(t){var i=null,n=function(){},r=function(){},s=function(){};"undefined"!==t&&("canvasParentId"in t&&(i=t.canvasParentId),"setup"in t&&(n=t.setup),"update"in t&&(r=t.update),"draw"in t&&(s=t.draw));var a=function(t){console.log("HDBG: Creating TinyApp SimpleApp in element: '"+t+"'"),e.App.call(this,t)};a.prototype=Object.create(e.App.prototype,{constructor:a,setup:{value:n},update:{value:r},draw:{value:s}});var o=new a(i);o.run()};return t.SimpleApp=i,t}(GNOCCHI);